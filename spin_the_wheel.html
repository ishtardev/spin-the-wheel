<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spin the Wheel Game</title>
    <style>
        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            background: #f0f0f0;
        }
        #wheelCanvas {
            background: #fff;
            border-radius: 50%;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
        }
        #spinBtn {
            margin-top: 30px;
            padding: 12px 32px;
            font-size: 1.2rem;
            border: none;
            border-radius: 8px;
            background: #4caf50;
            color: #fff;
            cursor: pointer;
            transition: background 0.2s;
        }
        #spinBtn:active {
            background: #388e3c;
        }
    </style>
</head>
<body>
    <canvas id="wheelCanvas" width="400" height="400"></canvas>
    <button id="spinBtn">Spin the Wheel!</button>
    <!-- Result tab that slides in when the wheel stops -->
    <div id="resultTab" aria-hidden="true">
        <div id="resultHeader">Result</div>
        <div id="resultBody">You won: <span id="prizeName"></span></div>
        <div id="resultActions">
            <button id="spinAgainBtn">Spin Again</button>
            <button id="closeResultBtn">Close</button>
        </div>
    </div>
    <script>
        // Result tab styles injected via JS to keep patch minimal and in one file
        const style = document.createElement('style');
        style.textContent = `
        #resultTab {
            position: fixed;
            right: -340px;
            top: 20%;
            width: 300px;
            background: #fff;
            box-shadow: 0 6px 18px rgba(0,0,0,0.15);
            border-radius: 8px;
            transition: right 300ms ease;
            font-family: Arial, sans-serif;
            z-index: 9999;
        }
        #resultTab.open { right: 20px; }
        #resultHeader { padding: 12px 16px; background: #1976d2; color: #fff; border-top-left-radius:8px; border-top-right-radius:8px; font-weight:600 }
        #resultBody { padding: 20px; font-size: 1.1rem; color: #222 }
        #resultActions { display:flex; gap:8px; padding: 12px 16px 18px }
        #resultActions button { flex:1; padding:8px 10px; border-radius:6px; border:none; cursor:pointer }
        #spinAgainBtn { background:#4caf50; color:#fff }
        #closeResultBtn { background:#e0e0e0 }
        `;
        document.head.appendChild(style);
        const canvas = document.getElementById('wheelCanvas');
        const ctx = canvas.getContext('2d');
        const spinBtn = document.getElementById('spinBtn');
        const slices = [
            'Prize 1', 'Prize 2', 'Prize 3', 'Prize 4',
            'Prize 5', 'Prize 6', 'Prize 7', 'Prize 8'
        ];
        const colors = [
            '#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0',
            '#9966FF', '#FF9F40', '#C9CBCF', '#FF6F61'
        ];
        const numSlices = slices.length;
        const arcSize = (2 * Math.PI) / numSlices;
        let angle = 0;
        let spinning = false;
        let spinVelocity = 0;
        let spinAcceleration = 0;

        // Result tab elements
        const resultTab = document.getElementById('resultTab');
        const prizeNameEl = document.getElementById('prizeName');
        const spinAgainBtn = document.getElementById('spinAgainBtn');
        const closeResultBtn = document.getElementById('closeResultBtn');

        function showResult(prize) {
            prizeNameEl.textContent = prize;
            resultTab.classList.add('open');
            resultTab.setAttribute('aria-hidden', 'false');
        }

        function hideResult() {
            resultTab.classList.remove('open');
            resultTab.setAttribute('aria-hidden', 'true');
        }

        function drawWheel(currentAngle) {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;
            const radius = Math.min(centerX, centerY) - 10;
            for (let i = 0; i < numSlices; i++) {
                ctx.beginPath();
                ctx.moveTo(centerX, centerY);
                ctx.arc(
                    centerX,
                    centerY,
                    radius,
                    currentAngle + i * arcSize,
                    currentAngle + (i + 1) * arcSize
                );
                ctx.closePath();
                ctx.fillStyle = colors[i % colors.length];
                ctx.fill();
                // Draw text
                ctx.save();
                ctx.translate(centerX, centerY);
                ctx.rotate(currentAngle + (i + 0.5) * arcSize);
                ctx.textAlign = 'right';
                ctx.font = '18px Arial';
                ctx.fillStyle = '#222';
                ctx.fillText(slices[i], radius - 20, 10);
                ctx.restore();
            }
            // Draw pointer
            ctx.save();
            ctx.beginPath();
            ctx.moveTo(centerX, centerY - radius - 10);
            ctx.lineTo(centerX - 20, centerY - radius + 20);
            ctx.lineTo(centerX + 20, centerY - radius + 20);
            ctx.closePath();
            ctx.fillStyle = '#e53935';
            ctx.fill();
            ctx.restore();
        }

        function animate() {
            if (!spinning) return;
            angle += spinVelocity;
            spinVelocity *= 0.985; // friction
            if (spinVelocity < 0.01) {
                spinning = false;
                spinVelocity = 0;
                // Wheel stopped â€” compute which slice is at the pointer and show result
                const selectedIndex = getSelectedSliceIndex();
                const prize = slices[selectedIndex];
                showResult(prize);
            }
            drawWheel(angle);
            requestAnimationFrame(animate);
        }

        // Compute which slice index is aligned with the pointer at the top
        function getSelectedSliceIndex() {
            const twoPI = Math.PI * 2;
            // Normalize angle to [0, 2PI)
            const normalized = ((angle % twoPI) + twoPI) % twoPI;
            // The pointer is at the top (270 degrees == 3PI/2 in canvas coords)
            const pointerOnWheel = (3 * Math.PI / 2 - normalized + twoPI) % twoPI;
            const index = Math.floor(pointerOnWheel / arcSize) % numSlices;
            return index;
        }

        spinBtn.addEventListener('click', () => {
            if (spinning) return;
            hideResult();
            spinVelocity = Math.random() * 0.3 + 0.35; // random initial speed
            spinning = true;
            animate();
        });

        // Result tab button handlers
        spinAgainBtn.addEventListener('click', () => {
            hideResult();
            if (!spinning) {
                spinVelocity = Math.random() * 0.3 + 0.35;
                spinning = true;
                animate();
            }
        });
        closeResultBtn.addEventListener('click', hideResult);

        // Initial draw
        drawWheel(angle);
    </script>
</body>
</html>
